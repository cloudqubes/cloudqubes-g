<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 5.11.0"/><meta name="theme-color" content="#a2466c"/><meta name="description" content="Ingress is the preferred way of exposing HTTP applications in Kubernetes. It can manipulate HTTP requests and route traffic to multiple applications inside the cluster." data-gatsby-head="true"/><meta name="image" content="https://www.cloudqubes.com/logo_v1.png" data-gatsby-head="true"/><meta name="twitter:card" content="summary_large_image" data-gatsby-head="true"/><meta name="twitter:title" content="How to use Kubernetes ingress for routing HTTP traffic" data-gatsby-head="true"/><meta name="twitter:url" content="https://www.cloudqubes.com" data-gatsby-head="true"/><meta name="twitter:description" content="Ingress is the preferred way of exposing HTTP applications in Kubernetes. It can manipulate HTTP requests and route traffic to multiple applications inside the cluster." data-gatsby-head="true"/><meta name="twitter:image" content="https://www.cloudqubes.com/logo_v1.png" data-gatsby-head="true"/><meta name="twitter:creator" content="@cloudqubes" data-gatsby-head="true"/><style data-href="/reponame/styles.ec9c685795f25abce049.css" data-identity="gatsby-global-css">.layout-module--main-header--0975f{border-bottom:2px solid #c21057aa;box-shadow:0 4px 4px -4px #c21057;display:flex;justify-content:center;margin-bottom:1rem;width:100%}.layout-module--inner-container--df4cb{display:flex;width:100%}@media only screen and (min-width:1200px){.layout-module--inner-container--df4cb{display:flex;width:90%}}.layout-module--logo-container--6ca7c{align-items:center;display:flex;flex-grow:1}.layout-module--logo--ff776{width:4rem}.layout-module--logo-text--e7423{color:#c21057;font-family:Titillium Web,sans-serif;font-size:38px;font-weight:400}.layout-module--nav-container--96fe9{display:flex;flex-grow:2;justify-content:space-around}.layout-module--nav-item-list--aaad3{display:flex;justify-content:space-around;list-style:none;width:100%}.layout-module--nav-item--3670c{display:inline-flex;font-size:1rem}.layout-module--footer--ad7d0{background-color:#c21057;display:flex;justify-content:center;padding-bottom:1rem;width:100%}.layout-module--footerCard--8fc61{flex-basis:50%;padding-bottom:1rem;padding-top:1rem}.layout-module--footerLogoContainer--67598{align-items:flex-end;display:flex;flex-basis:50%;justify-content:left;padding-bottom:1rem}.layout-module--footerLogo--cd38c{background-color:#fff;border-radius:2rem;width:4rem}.layout-module--footerLogoText--58444{color:#fff}.layout-module--footerAbout--6e9dd{color:#fff;padding-left:4rem}.layout-module--socialMediaIcons--19ec3{display:flex;justify-content:center}.layout-module--socialMediaLogo--1fd87{width:1.4rem}.layout-module--socialMediaLink--69be6{background-color:#fff;border-radius:2rem;margin-right:1rem;padding:.5rem}.layout-module--socialMediaLink--69be6:hover{background-color:#d4749bca}p{font-family:Titillium Web,sans-serif}h1,h2,h3,h4{font-weight:400;margin:0;padding:0}a,h1,h2,h3,h4{font-family:Raleway,sans-serif}a{text-decoration:none}body,ul{padding:0}body{margin:0;overflow-x:hidden;width:100%}.about-module--container--41d1b{display:flex;justify-content:center;width:100%}.about-module--inside-container--37fc5{width:100%}@media only screen and (min-width:1200px){.about-module--inside-container--37fc5{width:80%}}.blog-article-module--blog-article-item--77f8c{border-bottom:1px solid #8c8c8c;flex-basis:30%;margin-bottom:.2rem;padding-bottom:1rem}.blog-article-module--title--f5c09{color:#4d4d4d}.blog-article-module--title--f5c09:hover{color:#c21057}.blog-article-module--tag-link--30024{background-color:#f5f8ff;color:#546e7a;font-family:Raleway,sans-serif;font-size:1rem;margin-right:.2rem;padding:.1rem}.blog-article-module--tag-link--30024:hover{background-color:#e7edfd;text-decoration:none}.blog-article-module--post-meta--c0506{color:#8c8c8c;font-family:Titillium Web,sans-serif;font-size:.95rem}.index-module--container--efc35{display:flex;justify-content:center;width:100%}.index-module--inside-container--eedb3{width:100%}@media only screen and (min-width:1200px){.index-module--inside-container--eedb3{width:80%}}.index-module--blogArticleList--14500{display:flex;flex-wrap:wrap;justify-content:space-between}.article-module--outerContainer--119e3{display:flex;justify-content:center;width:100%}.article-module--container--2d8cc{width:100%}@media only screen and (min-width:1200px){.article-module--container--2d8cc{width:75%}}.article-module--title--f5d32{color:#c21057;font-family:Titillium Web,sans-serif;font-size:2.8rem}.article-module--post-meta--34964{color:#8c8c8c;font-family:Titillium Web,sans-serif;font-size:.95rem}li,p{margin-top:0;padding-top:0}.header-highlight,li,p{color:#2a2a2a;font-family:Titillium Web,sans-serif}.header-highlight{border-bottom:1px solid #2a2a2a;font-size:1.6rem;font-weight:400;margin-bottom:1rem}h1{color:#c21057;font-family:Titillium Web,sans-serif;font-size:26px;font-weight:400}h2{font-size:20px;padding-top:.5rem}h2,h3,h4,h5{color:#2a2a2a;font-family:Titillium Web,sans-serif;font-weight:600}h3,h4,h5{font-size:18px}.index-module--container--f8c32{display:flex;justify-content:center;width:100%}.index-module--newsletterOuterContainer--58d51{background-color:#c5cae9;display:flex;justify-content:center;padding-top:1rem;width:100%}.index-module--substackStyle--11694{background-color:#c5cae9}.index-module--inside-container--01d46{width:100%}@media only screen and (min-width:1200px){.index-module--inside-container--01d46{width:80%}}.index-module--newsletterContainer--437d4{align-items:center;display:flex;justify-content:space-around;width:100%}.index-module--blog-article-list--927c6{display:flex;flex-wrap:wrap;justify-content:space-between}.index-module--section-title--34611{padding-bottom:.8rem;padding-top:1.8rem}.tag-module--container--c379b{display:flex;justify-content:center;width:100%}.tag-module--inside-container--b0e69{width:100%}@media only screen and (min-width:1200px){.tag-module--inside-container--b0e69{width:80%}}.tag-module--blogArticleList--45e04{display:flex;flex-wrap:wrap;justify-content:space-between}.tag-module--title--fab01{color:#2a2a2a;font-family:Titillium Web,sans-serif;font-size:20px;font-weight:600;padding-bottom:.5rem}</style><link rel="preconnect" href="YOUR_SELF_HOSTED_ORIGIN"/><link rel="dns-prefetch" href="YOUR_SELF_HOSTED_ORIGIN"/><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="true"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="true"/><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Raleway:ital,wght@0,400;0,700;1,400&amp;family=Titillium+Web:ital,wght@0,400;0,600;0,700;1,400&amp;display=swap"/><link rel="icon" href="/reponame/favicon-32x32.png?v=c7817e006b3b3fde36d3536130dbde94" type="image/png"/><link rel="manifest" href="/reponame/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="192x192" href="/reponame/favicons/android-chrome-192x192.png?v=c7817e006b3b3fde36d3536130dbde94"/><link rel="apple-touch-icon" sizes="512x512" href="/reponame/favicons/android-chrome-512x512.png?v=c7817e006b3b3fde36d3536130dbde94"/><title data-gatsby-head="true">How to use Kubernetes ingress for routing HTTP traffic</title><link rel="icon" href="data:image/svg+xml,&lt;svg xmlns=&#x27;http://www.w3.org/2000/svg&#x27; viewBox=&#x27;0 0 100 100&#x27;&gt;&lt;text y=&#x27;0.9em&#x27; font-size=&#x27;90&#x27;&gt;ðŸ‘¤&lt;/text&gt;&lt;/svg&gt;" data-gatsby-head="true"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div><header class="layout-module--main-header--0975f"><div class="layout-module--inner-container--df4cb"><div class="layout-module--logo-container--6ca7c"><a href="/reponame/"><div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained layout-module--logo--ff776"><div style="max-width:400px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg%20height=&#x27;400&#x27;%20width=&#x27;400&#x27;%20xmlns=&#x27;http://www.w3.org/2000/svg&#x27;%20version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#080808;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="/reponame/static/c7817e006b3b3fde36d3536130dbde94/d8057/logo_v1.webp 100w,/reponame/static/c7817e006b3b3fde36d3536130dbde94/2e34e/logo_v1.webp 200w,/reponame/static/c7817e006b3b3fde36d3536130dbde94/416c3/logo_v1.webp 400w" sizes="(min-width: 400px) 400px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 400px) 400px, 100vw" decoding="async" loading="lazy" data-src="/reponame/static/c7817e006b3b3fde36d3536130dbde94/d6138/logo_v1.png" data-srcset="/reponame/static/c7817e006b3b3fde36d3536130dbde94/15e42/logo_v1.png 100w,/reponame/static/c7817e006b3b3fde36d3536130dbde94/5aead/logo_v1.png 200w,/reponame/static/c7817e006b3b3fde36d3536130dbde94/d6138/logo_v1.png 400w" alt="cloudqubes logo"/></picture><noscript><picture><source type="image/webp" srcSet="/reponame/static/c7817e006b3b3fde36d3536130dbde94/d8057/logo_v1.webp 100w,/reponame/static/c7817e006b3b3fde36d3536130dbde94/2e34e/logo_v1.webp 200w,/reponame/static/c7817e006b3b3fde36d3536130dbde94/416c3/logo_v1.webp 400w" sizes="(min-width: 400px) 400px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 400px) 400px, 100vw" decoding="async" loading="lazy" src="/reponame/static/c7817e006b3b3fde36d3536130dbde94/d6138/logo_v1.png" srcSet="/reponame/static/c7817e006b3b3fde36d3536130dbde94/15e42/logo_v1.png 100w,/reponame/static/c7817e006b3b3fde36d3536130dbde94/5aead/logo_v1.png 200w,/reponame/static/c7817e006b3b3fde36d3536130dbde94/d6138/logo_v1.png 400w" alt="cloudqubes logo"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div></a><a href="/reponame/"><h1 class="layout-module--logo-text--e7423">cloudqubes</h1></a></div><nav class="layout-module--nav-container--96fe9"><ul class="layout-module--nav-item-list--aaad3"><li class="layout-module--nav-item--3670c"><a href="/reponame/about/">About</a></li><li class="layout-module--nav-item--3670c"><a href="/reponame/blog/">Blog</a></li><li class="layout-module--nav-item--3670c"><a href="/reponame/contact/">Contact</a></li><li class="layout-module--nav-item--3670c"><a href="https://cloudqubes.substack.com/">Newsletter</a></li></ul></nav></div></header><main><div class="article-module--outerContainer--119e3"><article class="article-module--container--2d8cc"><div><span class="article-module--post-meta--34964">July 21, 2023<!-- --> - </span><span class="article-module--post-meta--34964">9 min read</span></div><h1 class="article-module--title--f5d32">How to use Kubernetes ingress for routing HTTP traffic</h1><div class="header-highlight"><p>Ingress is the preferred way of exposing HTTP applications in Kubernetes. It can manipulate HTTP requests and route traffic to multiple applications inside the cluster.</p></div>
<p><a href="https://kubernetes.io/docs/concepts/services-networking/ingress/">Kubernetes ingress</a> is a mechanism for exposing applications running inside a Kubernetes cluster via HTTP or HTTPS.</p>
<p><span><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 839px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/reponame/static/ba8e49cf0aac786ed9178a2e0e206f40/d26aa/k8s-ingress-simplified.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 49.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABVklEQVR42o1Sa2+DMAzs//97k9iX0SEEDMj7AbQrcLND23VdOy3SYZQ457Mvu3mesSzLL1z27+NjzNfzHX8era7rUBQFqqpCWZbQWiOEAO89fPDnGDb4gHEcsBDpQ8J1XeEoSWsDay2EEAlKaSgi1meYvoEXNUTXwDq3KeTLp+OEmXAi7ulzxXFeMTqBwXSkysMYQwU8olOYbIvgTCoWZI3JSzj5kc43QlKki1dCBhOPqNUAYQIWvceq36BFi7Zt0fc9BlkCdg/dlqRYIVqJAxXQSqYRJEJuMQ4Dxmn60baqc/TvL/DUilIKhloPRmAkUm8UpFTwssKBFFrRfCu8zJBbv129kKibNlXmeTkiDiEmA5IhFIPuEBXNT3Zp5k9dZvKBVEdykJ1lhQw2iNvPsgx5nieDNtNkKvjns4kxpiRWw5Evsjkc78H7nH99Ns8e9n9wm8v/XznZBSHmrvCkAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Kubernetes ingress - simplified"
        title=""
        src="/reponame/static/ba8e49cf0aac786ed9178a2e0e206f40/d26aa/k8s-ingress-simplified.png"
        srcset="/reponame/static/ba8e49cf0aac786ed9178a2e0e206f40/5a46d/k8s-ingress-simplified.png 300w,
/reponame/static/ba8e49cf0aac786ed9178a2e0e206f40/0a47e/k8s-ingress-simplified.png 600w,
/reponame/static/ba8e49cf0aac786ed9178a2e0e206f40/d26aa/k8s-ingress-simplified.png 839w"
        sizes="(max-width: 839px) 100vw, 839px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></span>
<em>Kubernetes ingress - simplified</em></p>
<p>This is a simple representation of Kubernetes ingress. To learn how ingress works, you can read up on <a href="../ingress-vs-ingress-controller">Kubenetes ingress vs ingress controller</a>.</p>
<p><a href="https://cloudqubes.substack.com/i/106867327/nodeport">NodePort</a> or <a href="https://cloudqubes.substack.com/i/111987521/loadbalancer-services">LoadBalancer</a> Services also can expose an application running inside a cluster. But, both <a href="https://cloudqubes.substack.com/i/106867327/nodeport">NodePort</a> and <a href="https://cloudqubes.substack.com/i/111987521/loadbalancer-services">LoadBalancer</a> Services work in layer-3 in the OSI model.</p>
<p>Ingress works with HTTP protocol in layer-7 so offers more flexibility for HTTP-based applications. Also, ingress does not have some of the limitations in <a href="https://cloudqubes.substack.com/i/106867327/nodeport">NodePort</a> or <a href="https://cloudqubes.substack.com/i/111987521/loadbalancer-services">LoadBalancer</a> Services.</p>
<p>So, ingress should be your preferred way for exposing HTTP applications inside a Kubernetes cluster to external clients.</p>
<p>An ingress defines a set of rules for routing HTTP traffic. You can use these rules to manipulate HTTP requests.</p>
<p>Let&#x27;s check out three such usecases of ingress rules for handling HTTP traffic.</p>
<h1>Kubernetes cluster setup</h1>
<p>We are using <a href="https://microk8s.io">MicroK8s</a> from Canonical as our Kubernetes platform for this demonstration.</p>
<p><a href="https://microk8s.io">MicroK8s</a> includes <a href="https://github.com/kubernetes/ingress-nginx">Ingress NGINX Controller</a> as an add-on. Since <a href="https://github.com/kubernetes/ingress-nginx">Ingress NGINX controller</a> is deployed inside the cluster, we need to place a load balancer in front of the ingress controller. So we&#x27;ll use <a href="https://metallb.universe.tf">MetalLB</a> load balancer which also comes as an add-on in <a href="https://microk8s.io">MicroK8s</a>.</p>
<p><span><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 978px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/reponame/static/2e6c4731acda16f8ab04929a2d707aa2/914c7/k8s-ingress-microk8s.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 41.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABRElEQVR42n2S226DMBBE8/9/1vc+Jo0QpebiO2DAgKe7hkRRW9XSCO9KO4yPfdn3HSmlX+L+MAzw3qPveyzLgnVdD8VI3/isY1yf+wsP/rW4L+oaVVXh60vAWgtjDJSSJJ2lNYlqqzqqFaZpOg33jVLtmNeEKVK6RK0YMDiNkVKOTsE7l4dyYiOzjHVwbYWgPmFkgzEEMtw2mPIKTw3ZL2gtGY0BCBKLFTRQAvYK11Vo2g5SdlhNgUXe0TQNevrp5FoYrTDS3IV5eaOwzOE8bMpyskYnSshG4P7+BquPo1pKOugao20ooYWVAqMWMKo9DF8ZplO8pnmG0sSMON2LMhsxM74g3w+0NwcCSwk9cXwk/O9SmJf3LnP0pyGb8LcoCtxuHxmBIjMpJQIz3IghD/8U92dKyeLbe90/an5Kj5oV6Tl9A0LYaWwRFs9CAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Microk8s cluster"
        title=""
        src="/reponame/static/2e6c4731acda16f8ab04929a2d707aa2/914c7/k8s-ingress-microk8s.png"
        srcset="/reponame/static/2e6c4731acda16f8ab04929a2d707aa2/5a46d/k8s-ingress-microk8s.png 300w,
/reponame/static/2e6c4731acda16f8ab04929a2d707aa2/0a47e/k8s-ingress-microk8s.png 600w,
/reponame/static/2e6c4731acda16f8ab04929a2d707aa2/914c7/k8s-ingress-microk8s.png 978w"
        sizes="(max-width: 978px) 100vw, 978px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></span>
<em>MicroK8s cluster</em></p>
<p>Since this MicroK8s cluster is installed in a single virtual machine, our application will be accessible only via localhost (127.0.0.1). But in a production Kubernetes cluster the application will be avialble from one of the public IPs in the load balancer.</p>
<p>Let&#x27;s enable both add-ons in the cluster.</p>
<pre><code class="language-yaml">microk8s enable ingress
microk8s enable metallb
</code></pre>
<p>Check the status of Ingress NGINX Controller.</p>
<pre><code class="language-shell">kubectl get pods -n ingress
</code></pre>
<pre><code class="language-shell">NAME                                      READY   STATUS    RESTARTS   AGE
nginx-ingress-microk8s-controller-8672t   1/1     Running   0          2m10s
</code></pre>
<p>Check the status of MetalLB</p>
<pre><code class="language-shell">kubectl get pods -n metallb-system
</code></pre>
<pre><code class="language-shell">NAME                         READY   STATUS    RESTARTS      AGE
speaker-xfbbt                1/1     Running   6 (72d ago)   14m
controller-9556c586f-g9r7w   1/1     Running   3 (72d ago)   14m
</code></pre>
<p>If all Pods are in <code>Running </code> status, you can proceed to the next step.</p>
<h1>The number-crunch application</h1>
<p>We will use <a href="https://github.com/cloudqubes/number-crunch">number-crunch</a> application for this ingress use cases demonstration.</p>
<p>The <code>number-crunch</code> is a simple HTTP server with two API endpoints that calculate the square root and the cube root of a number.</p>
<p><span><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/reponame/static/65a3e17afa0d39b2f3d90a566c69efa8/c5bb3/k8s-ingress-number-crunch-app-only.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 37.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAyUlEQVR42qWR2aqFMAxF/f//E30QxBGrCM5ap326Ay3lPl3OCSzSpO1OkwbPfeN9HjwWEwt+zua9WB8H9n0XDrJtuK8LAQ9+Y8uyCOu6Yp5njOOIi4Lv+6Lve2EYBuR5jjRN0TQNuq4TT6qqgtZaLvFVFCvLElEUQZl9ip7niQBGULUtlFJojU+SBHEcI8sy1HWNoijcmsWnaZJC9LwThqEUdIKcB42H/+LPjLFvtk0fadkK/tdssc18Audn/WpG4ATdz/6CEaPWBylqIMKsSlxEAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="number-crunch application"
        title=""
        src="/reponame/static/65a3e17afa0d39b2f3d90a566c69efa8/c5bb3/k8s-ingress-number-crunch-app-only.png"
        srcset="/reponame/static/65a3e17afa0d39b2f3d90a566c69efa8/5a46d/k8s-ingress-number-crunch-app-only.png 300w,
/reponame/static/65a3e17afa0d39b2f3d90a566c69efa8/0a47e/k8s-ingress-number-crunch-app-only.png 600w,
/reponame/static/65a3e17afa0d39b2f3d90a566c69efa8/c5bb3/k8s-ingress-number-crunch-app-only.png 680w"
        sizes="(max-width: 680px) 100vw, 680px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></span>
<em>number-crunch application</em></p>
<h2>Creating the Deployment</h2>
<p>We will deploy <code>number-crunch</code> with two replicas in our MicroK8s cluster.</p>
<p><span><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 901px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/reponame/static/1a2493452edbf4fc4078f0a185ba764a/0955e/k8s-ingress-number-crunch-1-without-prefix.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 46.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABe0lEQVR42n1S226DMAzt/3/btqd22kO7lbYEUO4Q7oEzO6XVpE0LsuKg42P72LsYI9ZlwbIZ++u6JpvGEaFt0f5noSGrEUKLkfA7Jvl1lhnEjGma4L2Hdwa1r1HX9f1tDTz5zlo0WqC1ZcL0w0CEVCGfoAoEXREPVdxKoFMEoAopYHVnNKaCdTU6V6W3J7xWCq0p0JHV3mFgwrgRGnGBLW+IccbclIitonZ7+DJDL/ZwUkAqA12cMcojpMiglEZnq5TkSfhoeZoj4uZn2Rla6+Rfrle8vb5QsETTNDh9fmF/OOB2y6llkkLlCFwhtTwMPzXkQfBH7zjPaSgssiWdnPNJO9aQSflfw3qSnY5HfLwfUBRF0vzPoTBZqpoATBBokvc7pMl2XfecMpMbY1LC1PKjEikl8jxPmTiQTz9M6PoefT9gpqo5WAiRcFVVJVmWbc345nnsuEXeN0tZFJEaAnEC/s9rwGTDOIG3gTEFEQoiLCmxd+4u1YOUMN9WELVjXLUkjwAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="number-crunch application deployment"
        title=""
        src="/reponame/static/1a2493452edbf4fc4078f0a185ba764a/0955e/k8s-ingress-number-crunch-1-without-prefix.png"
        srcset="/reponame/static/1a2493452edbf4fc4078f0a185ba764a/5a46d/k8s-ingress-number-crunch-1-without-prefix.png 300w,
/reponame/static/1a2493452edbf4fc4078f0a185ba764a/0a47e/k8s-ingress-number-crunch-1-without-prefix.png 600w,
/reponame/static/1a2493452edbf4fc4078f0a185ba764a/0955e/k8s-ingress-number-crunch-1-without-prefix.png 901w"
        sizes="(max-width: 901px) 100vw, 901px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></span>
<em>number-crunch application deployment</em></p>
<p>Copy and paste this YAML manifest into <code>number-crunch-deployment.yml</code>.</p>
<pre><code class="language-yaml">apiVersion: apps/v1
kind: Deployment
metadata:
  name: number-crunch-app
spec:
  selector:
    matchLabels:
      app: number-crunch-app
  replicas: 2 
  template:
    metadata:
      labels:
        app: number-crunch-app
    spec:
      containers:
      - name: number-crunch-app
        image: cloudqubes/number-crunch:1.0.1
        ports:
        - containerPort: 8080
</code></pre>
<p>Create the deployment.</p>
<pre><code class="language-shell">kubectl apply -f number-crunch-deployment.yml
</code></pre>
<p>Check the status of the pods.</p>
<pre><code class="language-shell">kubectl get pods
</code></pre>
<pre><code class="language-shell">NAME                                 READY   STATUS    RESTARTS       AGE     
number-crunch-app-5866dd4d7f-zslzf   1/1     Running   0              3m33s
number-crunch-app-5866dd4d7f-74w9v   1/1     Running   0              3m33s
</code></pre>
<p>Since both pods are running, let&#x27;s create the Service,</p>
<h2>Creating the Service</h2>
<p>We need a Kubernetes Service to be used as the backend for the ingress.</p>
<p>Copy and paste this YMAL manifest into <code>number-crunch-service.yml</code>.</p>
<pre><code class="language-yaml">apiVersion: v1
kind: Service
metadata:
  name: number-crunch-service
spec:
  selector:
    app: number-crunch-app
  ports:
  - name: number-crunch-service-port
    protocol: TCP
    port: 3001
    targetPort: 8080
</code></pre>
<p>Create <code>number-crunch-service</code>.</p>
<pre><code class="language-shell">kubectl apply -f number-crunch-service.yml 
</code></pre>
<p>Check the <code>number-crunch-service</code>.</p>
<pre><code class="language-shell">kubectl get services
</code></pre>
<pre><code class="language-shell">NAME                    TYPE           CLUSTER-IP       EXTERNAL-IP   PORT(S)          AGE
number-crunch-service   ClusterIP      10.152.183.17    &lt;none&gt;        3001/TCP         5m10s
</code></pre>
<h1>Use case #1: Exposing an application via HTTP</h1>
<p>As out first use case, we wil simply expose the <code>number-crunch</code> API endpoints via ingress.</p>
<p>Create <code>ingress.yml</code> with this YAML manifest.</p>
<pre><code class="language-yaml">apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: number-crunch-ingress
spec:
  ingressClassName: nginx
  rules:
  - http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: number-crunch-service
            port:
              number: 3001
</code></pre>
<p>Take note of these key parameters in <code>ingress.yml</code>.</p>
<ul>
<li>
<p><strong>ingressClassName</strong> identifies the Ingress Controller we wish to use.</p>
<p>When there are multiple ingress controllers in a cluster, we can choose the desired ingress controller by specifying this parameter.</p>
<p>If we omit this parameter, Kubernetes will assign the default <code>IngressClass</code> to our ingress. If we specify a non-existing ingress controller, our ingress would still be created, but Kubernetes will not assign an ingress controller for our ingress. So, traffic cannot be routed.</p>
<p>If you find the your ingress is not being assigned an address, most probably you may have specified a non-existent ingress controller.</p>
<p>You can check the available IngressClasses in your cluster.</p>
<pre><code class="language-shell">kubectl get ingressclasses
</code></pre>
<p>Here&#x27;s what we got in MicroK8s.</p>
<pre><code class="language-shell">NAME     CONTROLLER             PARAMETERS   AGE
public   k8s.io/ingress-nginx   &lt;none&gt;       1d
nginx    k8s.io/ingress-nginx   &lt;none&gt;       1d
</code></pre>
</li>
<li>
<p><strong>rules</strong> define how to route HTTP traffic to the back-end Kubernetes Services. This ingress has just one rule which sends all traffic to <code>number-crunch</code> Service on port 3001.</p>
</li>
<li>
<p><strong>path</strong> defines the URL to be matched. <code>/</code> denotes the root and matches all HTTP requests.</p>
</li>
</ul>
<p>Create the ingress resource.</p>
<pre><code class="language-shell">kubectl apply -f ingress.yml
</code></pre>
<p>Check the ingress resource.</p>
<pre><code class="language-shell"> kubectl get ingress
</code></pre>
<pre><code class="language-shell">NAME                    CLASS    HOSTS   ADDRESS     PORTS   AGE
number-crunch-ingress   public   *       127.0.0.1   80      175m
</code></pre>
<p>Note the <code>ADDRESS</code> and the <code>PORTS</code> fields. Our application will be available on http://127.0.0.1/xyz.</p>
<p>If the <code>ADDRESS</code> field is blank, please check the ingress agian in a few minutes.
Sometimes, Kubernetes may take about one minute to assign the <code>ADDRESS</code> to a newly-created ingress resource.</p>
<p>Test the <code>number-crunch</code> application.</p>
<pre><code class="language-shell">curl http://127.0.0.1/square-root/4
</code></pre>
<pre><code class="language-shell">{&quot;InputNumber&quot;:4,&quot;SquareRoot&quot;:2}
</code></pre>
<pre><code class="language-shell">curl http://127.0.0.1/cube-root/8
</code></pre>
<pre><code class="language-shell">{&quot;InputNumber&quot;:4,&quot;CubeRoot&quot;:2}
</code></pre>
<h1>Use case #2: Adding a URL prefix</h1>
<p>To avoid URL duplications, we shall add the prefix <code>number-crunch</code> to all URLs in the <code>number-crunch</code> application.</p>
<p><span><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 907px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/reponame/static/418e7a4e81748aaff0eeb5f6320ddd0e/142fb/k8s-ingress-number-crunch-1.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 47%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABeElEQVR42n1Si07DMBDr/3/cQEJim5BYx/pa1jZJ82j6NHdZgSEkIlnXVhefz26yzDPWdcW6LHfwcwQwDgOstbDO3esXtndH1VkNZ3T8No4jkoVI/px5BNYZAzUopaBlg0536DqC1ujoXXcGiqppK3h1hVYSgQQkrJCPERkhx0Jkq6sBgvMBts4AlaJrKrRSw8sK0BnkrUTdNLBNAdeWcdDwSKhEAUVNTDioEpMhwj5AVSnM+RmqrohAoi5O6KsjRJmhrqlHClIoiFBthNvK0zRh2sg/Ps5o2zZ6eblcsNs90WVazxi8n07YHw4oypKsaKNyS6S88i/CnzBWLFs4IYTooSG/NHtHHnLlYVw1+fp23OP4+oKquv4Tyna4gVVZa2LlVH3fIxC895SwhaSBDB72rZDV8EQ2WUoZFTjnKbWRLvLlEC1hz9iCNE2R5zka6n/cipHM5Bs/TKSGFUUvt8oTee0hDODwOMnb7QYhBGqqrBAP/zD3fAJsALYpCOcs9AAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="number-crunch application deployment"
        title=""
        src="/reponame/static/418e7a4e81748aaff0eeb5f6320ddd0e/142fb/k8s-ingress-number-crunch-1.png"
        srcset="/reponame/static/418e7a4e81748aaff0eeb5f6320ddd0e/5a46d/k8s-ingress-number-crunch-1.png 300w,
/reponame/static/418e7a4e81748aaff0eeb5f6320ddd0e/0a47e/k8s-ingress-number-crunch-1.png 600w,
/reponame/static/418e7a4e81748aaff0eeb5f6320ddd0e/142fb/k8s-ingress-number-crunch-1.png 907w"
        sizes="(max-width: 907px) 100vw, 907px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></span>
<em>number-crunch application deployment</em></p>
<p>Update the <code>ingress.yml</code> as below.</p>
<pre><code class="language-yaml">apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: number-crunch-ingress
  annotations:
    nginx.ingress.kubernetes.io/use-regex: &quot;true&quot;
    nginx.ingress.kubernetes.io/rewrite-target: /$1
spec:
  ingressClassName: nginx
  rules:
  - http:
      paths:
      - path: /number-crunch/(.*)
        pathType: Prefix
        backend:
          service:
            name: number-crunch-service
            port:
              number: 3001
</code></pre>
<p>In this manifest, we are using ingress <code>annotations</code> to manipulate the URLs using regular expressions.</p>
<p>We define the new <code>path</code> as <code>/number-crunch/(.*)</code>.</p>
<p>The string inside paranthesis is called a Capturing Group in a regular expression. We define one capturing group <code>(.*)</code> which captures all characters after <code>/number-crunch/</code> in the URL.</p>
<p>The characters matching a capturing group is copied to numbered placeholders like $1, $2, $n. Since we have only one capture group, all characters after the <code>/number-crunch/</code> in the URL is copied to <code>$1</code>.</p>
<p>As an example, if the URL in the HTTP request is <code>number-crunch/square-root/4</code>, the characters <code>square-root/4</code> will be available in <code>$1</code>.</p>
<p>Then, we use <code>$1</code> as the <code>rewrite-target</code>. This effectively truncates the string <code>number-crunch/</code> from the incoming HTTP requests and the traffic to the <code>number-crunch-service</code>.</p>
<p>Let&#x27;s update the ingress resource.</p>
<pre><code class="language-shell">kubectl apply -f ingress.yml
</code></pre>
<p>Test the updated URL endpoints.</p>
<pre><code class="language-shell">curl http://127.0.0.1:80/number-crunch/square-root/16
</code></pre>
<pre><code class="language-shell">{&quot;InputNumber&quot;:16,&quot;SquareRoot&quot;:4}
</code></pre>
<p>You may appreciate that we did not have to change anything in our application for this change of the URLs.</p>
<h1>Use case #3: number-crunch-2</h1>
<p><span><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 974px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/reponame/static/818764d89dfc716c8771a97efee89f40/09e48/k8s-ingress-number-crunch-2.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 57.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABxklEQVR42n2TaY+bQAyG8/9/2+6HbrbtHkoUCJkEmPtKOMJbe+ipdjuSJTOY148PNvM8Y1mWv+x6vSLGiJQScs6wxqA5nSDEGYb8K93l6H6+ZxvHEZv7/Y5/HRaz1sI5V4z9z9tP+PL8BKk0vLogmRZGtdDaQCmF2+32sSBnds7D+4AQAhFqTOaIUVdoux5enjFZgXNT42n7jLquV8KFBFebi9AyRCzzSIIZ3nQIVhYCKSWSFkjqVJ4dCUZ9gdM9tUIUwmEYSJBEwqWCO1eYxhuQW8zZwmiFWe8xyD26rlspidY6Jo4lUVYNgrMlOb8vJYMUcwzIKTIfpDjglgMSNbl62+K0/1qGwATBSETTw1A/raQeur4QKiLWWv/qIU+VD/u9pOYSes4Jh7rBsRElO38w2SNmc0DbdnA0jNE06ESDh8dH7Ha7teT/DYUnzea9J0KNaveC4/6VBNsimG2P6BRVsG7Dh4JMzELut7UJJPpOFK9v7/BEHDzdU9nOmpKQY0rJvNg8blZnn42T8GKX5odUfO6hEAKClvt8WZd7GKci8sOmacKGSTi47/vSJw5ct36moAFXMibmmFP5U0SJZYDv9fxR2TcG60ym7JfB8AAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="number-crunch-2"
        title=""
        src="/reponame/static/818764d89dfc716c8771a97efee89f40/09e48/k8s-ingress-number-crunch-2.png"
        srcset="/reponame/static/818764d89dfc716c8771a97efee89f40/5a46d/k8s-ingress-number-crunch-2.png 300w,
/reponame/static/818764d89dfc716c8771a97efee89f40/0a47e/k8s-ingress-number-crunch-2.png 600w,
/reponame/static/818764d89dfc716c8771a97efee89f40/09e48/k8s-ingress-number-crunch-2.png 974w"
        sizes="(max-width: 974px) 100vw, 974px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></span>
<em>number-crunch-2</em></p>
<p><code>number-crunch</code> is gaining popularity. We are getting millions of requests everyday.</p>
<span><p>ï˜€</p></span>
<p>We want to make <code>number-crunch</code> more scalable. So, we split the <code>square-root</code> and <code>cube-root</code> API end-points to two different micro-services and create <a href="https://github.com/cloudqubes/number-crunch-2">number-crunch-2</a>.</p>
<p>We want to upgrade to <code>number-crucnch-2</code> without disturbing our clients.</p>
<p>We can easily achieve this by manipulating URLs in ingress.</p>
<p>Let&#x27;s deploy the two microservices.</p>
<p>Create <code>square-root.yml</code> manifest.</p>
<pre><code class="language-yaml">apiVersion: apps/v1
kind: Deployment
metadata:
  name: square-root-app
spec:
  selector:
    matchLabels:
      app: square-root-app
  replicas: 2 
  template:
    metadata:
      labels:
        app: square-root-app
    spec:
      containers:
      - name: square-root-app
        image: cloudqubes/square-root:2.0.1
        ports:
        - containerPort: 8080
---
apiVersion: v1
kind: Service
metadata:
  name: square-root-service
spec:
  selector:
    app: square-root-app
  ports:
  - name: square-root-service-port
    protocol: TCP
    port: 3001
    targetPort: 8080

</code></pre>
<p>Deploy <code>square-root</code> micro-service.</p>
<pre><code class="language-shell">kubectl apply -f square-root.yml
</code></pre>
<p>Create <code>cube-root.yml</code> manifest.</p>
<pre><code class="language-yaml">apiVersion: apps/v1
kind: Deployment
metadata:
  name: cube-root-app
spec:
  selector:
    matchLabels:
      app: cube-root-app
  replicas: 2 
  template:
    metadata:
      labels:
        app: cube-root-app
    spec:
      containers:
      - name: cube-root-app
        image: cloudqubes/cube-root:2.0.1
        ports:
        - containerPort: 8080
---
apiVersion: v1
kind: Service
metadata:
  name: cube-root-service
spec:
  selector:
    app: cube-root-app
  ports:
  - name: cube-root-service-port
    protocol: TCP
    port: 3001
    targetPort: 8080
</code></pre>
<p>Deploy <code>cube-root</code> micro-service.</p>
<pre><code class="language-shell">kubectl apply -f cube-root.yml
</code></pre>
<p>Check the deployments and the Services.</p>
<pre><code class="language-shell">kubectl get deployments
</code></pre>
<pre><code class="language-shell">NAME               READY   UP-TO-DATE   AVAILABLE   AGE
square-root-app    2/2     2            2           10m
cube-root-app      2/2     2            2           10m
</code></pre>
<pre><code class="language-shell">kubectl get services
</code></pre>
<pre><code class="language-shell">NAME                  TYPE           CLUSTER-IP       EXTERNAL-IP   PORT(S)          AGE
square-root-service   ClusterIP      10.152.183.195   &lt;none&gt;        3001/TCP         12m
cube-root-service     ClusterIP      10.152.183.104   &lt;none&gt;        3001/TCP         12m
</code></pre>
<p>Update <code>ingress.yml</code>.</p>
<pre><code class="language-yaml">apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: number-crunch-2-ingress
  annotations:
    nginx.ingress.kubernetes.io/use-regex: &quot;true&quot;
    nginx.ingress.kubernetes.io/rewrite-target: /$1/$2
spec:
  ingressClassName: nginx
  rules:
  - http:
      paths:
      - path: /number-crunch/(square-root)/(.*)?$
        pathType: Prefix
        backend:
          service:
            name: square-root-service
            port:
              number: 3001
      - path: /number-crunch/(cube-root)/(.*)?$
        pathType: Prefix
        backend:
          service:
            name: cube-root-service
            port:
              number: 3001
</code></pre>
<p>We have added two rules - one for each micro-service. The <code>path</code> in each rule defines two capturing groups, which copy the matching characters to <code>$1</code> and <code>$2</code> respectively.</p>
<p>In the annotation <code>rewrite-target</code> we use <code>/$1/$2</code> so effectively removing the <code>number-crunch/</code> part in the URL.</p>
<p><span><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 689px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/reponame/static/bd18e74746a58d843b84a1f8c0a49b64/0f79a/k8s-ingress-capturing-group.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 36.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAA7EAAAOxAGVKw4bAAABAklEQVR42qWRW2rDMBBFs7VA9hZospssJO53Pkrj4NqVrYcl23rZtxolbimUfrQDF82MhsM8NjFGLMuC1eI8g0LK/ar5/s6pnhghhBxvCGWKAtfDAeXxiKA1etdDDhyTH9FPEsZqyJFjcBqjM9BWwUULPSmE6HMjBCZloD6fE/AJr/s9gpTglqPTTQZw02YoHxgaUUEkMOVayaAmARfcd+BMY/Y9xssFtixpVsQlwkeXxg933zt4ZSDKN0xcQdcMomoyaF3XJ5CC9nRCsd3iebeDZwzSSdy6F6jUTWfewfoaFb8mv0mr6FCLW+rM/gykIzx+8B/7AqYLkXLi4f9F65U/AGQ8HA8TyLNGAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Capturing groups for number-crunch-2"
        title=""
        src="/reponame/static/bd18e74746a58d843b84a1f8c0a49b64/0f79a/k8s-ingress-capturing-group.png"
        srcset="/reponame/static/bd18e74746a58d843b84a1f8c0a49b64/5a46d/k8s-ingress-capturing-group.png 300w,
/reponame/static/bd18e74746a58d843b84a1f8c0a49b64/0a47e/k8s-ingress-capturing-group.png 600w,
/reponame/static/bd18e74746a58d843b84a1f8c0a49b64/0f79a/k8s-ingress-capturing-group.png 689w"
        sizes="(max-width: 689px) 100vw, 689px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></span>
<em>Capturing groups for number-crunch-2</em></p>
<p>Let&#x27;s update the ingress.</p>
<pre><code class="language-shell">kubectl apply -f ingress.yml
</code></pre>
<p>Test the API end-points with <code>curl</code>.</p>
<pre><code class="language-shell">curl http://127.0.0.1:80/number-crunch/square-root/16
</code></pre>
<pre><code class="language-shell">{&quot;InputNumber&quot;:16,&quot;SquareRoot&quot;:4}
</code></pre>
<pre><code class="language-shell">curl http://127.0.0.1:80/number-crunch/cube-root/16
</code></pre>
<pre><code class="language-shell">{&quot;InputNumber&quot;:16,&quot;CubeRoot&quot;:2.5198420997897464}
</code></pre>
<h1>Ingress in production</h1>
<p>Ingress is the preferred method for routing external HTTP and HTTPS traffic to applications inside a Kubernetes cluster.</p>
<p>We demonstrated three HTTP routing use cases with <a href="https://github.com/kubernetes/ingress-nginx">Ingress NGINX Controller</a> in a <a href="https://microk8s.io">MicroK8s</a> cluster.</p>
<p>If you are using a different ingress controller, please refer the relevant documentation as the features and functions may vary across different ingress controller implementations.</p></article></div></main><footer class="layout-module--footer--ad7d0"><div class="layout-module--inner-container--df4cb"><div class="layout-module--footerCard--8fc61"><div class="layout-module--footerLogoContainer--67598"><a href="/reponame/"><div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained layout-module--footerLogo--cd38c"><div style="max-width:400px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg%20height=&#x27;400&#x27;%20width=&#x27;400&#x27;%20xmlns=&#x27;http://www.w3.org/2000/svg&#x27;%20version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#080808;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="/reponame/static/c7817e006b3b3fde36d3536130dbde94/d8057/logo_v1.webp 100w,/reponame/static/c7817e006b3b3fde36d3536130dbde94/2e34e/logo_v1.webp 200w,/reponame/static/c7817e006b3b3fde36d3536130dbde94/416c3/logo_v1.webp 400w" sizes="(min-width: 400px) 400px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 400px) 400px, 100vw" decoding="async" loading="lazy" data-src="/reponame/static/c7817e006b3b3fde36d3536130dbde94/d6138/logo_v1.png" data-srcset="/reponame/static/c7817e006b3b3fde36d3536130dbde94/15e42/logo_v1.png 100w,/reponame/static/c7817e006b3b3fde36d3536130dbde94/5aead/logo_v1.png 200w,/reponame/static/c7817e006b3b3fde36d3536130dbde94/d6138/logo_v1.png 400w" alt="cloudqubes logo"/></picture><noscript><picture><source type="image/webp" srcSet="/reponame/static/c7817e006b3b3fde36d3536130dbde94/d8057/logo_v1.webp 100w,/reponame/static/c7817e006b3b3fde36d3536130dbde94/2e34e/logo_v1.webp 200w,/reponame/static/c7817e006b3b3fde36d3536130dbde94/416c3/logo_v1.webp 400w" sizes="(min-width: 400px) 400px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 400px) 400px, 100vw" decoding="async" loading="lazy" src="/reponame/static/c7817e006b3b3fde36d3536130dbde94/d6138/logo_v1.png" srcSet="/reponame/static/c7817e006b3b3fde36d3536130dbde94/15e42/logo_v1.png 100w,/reponame/static/c7817e006b3b3fde36d3536130dbde94/5aead/logo_v1.png 200w,/reponame/static/c7817e006b3b3fde36d3536130dbde94/d6138/logo_v1.png 400w" alt="cloudqubes logo"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div></a><a href="/reponame/"><h1 class="layout-module--footerLogoText--58444">cloudqubes</h1></a></div><div><a class="layout-module--footerAbout--6e9dd" href="/reponame/about/">About</a></div></div><div class="layout-module--footerCard--8fc61"><div class="layout-module--socialMediaIcons--19ec3"><a href="https://github.com/cloudqubes" class="layout-module--socialMediaLink--69be6"><div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained layout-module--socialMediaLogo--1fd87"><div style="max-width:240px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg%20height=&#x27;240&#x27;%20width=&#x27;240&#x27;%20xmlns=&#x27;http://www.w3.org/2000/svg&#x27;%20version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#080808;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="/reponame/static/43ce87609eb221d09d4832a9c0e709d0/927d1/github-mark.webp 60w,/reponame/static/43ce87609eb221d09d4832a9c0e709d0/507b0/github-mark.webp 120w,/reponame/static/43ce87609eb221d09d4832a9c0e709d0/8d565/github-mark.webp 240w" sizes="(min-width: 240px) 240px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 240px) 240px, 100vw" decoding="async" loading="lazy" data-src="/reponame/static/43ce87609eb221d09d4832a9c0e709d0/87351/github-mark.png" data-srcset="/reponame/static/43ce87609eb221d09d4832a9c0e709d0/7ab40/github-mark.png 60w,/reponame/static/43ce87609eb221d09d4832a9c0e709d0/a8b52/github-mark.png 120w,/reponame/static/43ce87609eb221d09d4832a9c0e709d0/87351/github-mark.png 240w" alt="cloudqubes logo"/></picture><noscript><picture><source type="image/webp" srcSet="/reponame/static/43ce87609eb221d09d4832a9c0e709d0/927d1/github-mark.webp 60w,/reponame/static/43ce87609eb221d09d4832a9c0e709d0/507b0/github-mark.webp 120w,/reponame/static/43ce87609eb221d09d4832a9c0e709d0/8d565/github-mark.webp 240w" sizes="(min-width: 240px) 240px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 240px) 240px, 100vw" decoding="async" loading="lazy" src="/reponame/static/43ce87609eb221d09d4832a9c0e709d0/87351/github-mark.png" srcSet="/reponame/static/43ce87609eb221d09d4832a9c0e709d0/7ab40/github-mark.png 60w,/reponame/static/43ce87609eb221d09d4832a9c0e709d0/a8b52/github-mark.png 120w,/reponame/static/43ce87609eb221d09d4832a9c0e709d0/87351/github-mark.png 240w" alt="cloudqubes logo"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div></a><a href="https://twitter.com/cloudqubes" class="layout-module--socialMediaLink--69be6"><div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained layout-module--socialMediaLogo--1fd87"><div style="max-width:2400px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg%20height=&#x27;2453&#x27;%20width=&#x27;2400&#x27;%20xmlns=&#x27;http://www.w3.org/2000/svg&#x27;%20version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#080808;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="/reponame/static/c019bd434e5489eb40e386b60cf045c9/63168/logo-black.webp 600w,/reponame/static/c019bd434e5489eb40e386b60cf045c9/13b13/logo-black.webp 1200w,/reponame/static/c019bd434e5489eb40e386b60cf045c9/b4361/logo-black.webp 2400w" sizes="(min-width: 2400px) 2400px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2400px) 2400px, 100vw" decoding="async" loading="lazy" data-src="/reponame/static/c019bd434e5489eb40e386b60cf045c9/78e61/logo-black.png" data-srcset="/reponame/static/c019bd434e5489eb40e386b60cf045c9/7237d/logo-black.png 600w,/reponame/static/c019bd434e5489eb40e386b60cf045c9/02c57/logo-black.png 1200w,/reponame/static/c019bd434e5489eb40e386b60cf045c9/78e61/logo-black.png 2400w" alt="cloudqubes logo"/></picture><noscript><picture><source type="image/webp" srcSet="/reponame/static/c019bd434e5489eb40e386b60cf045c9/63168/logo-black.webp 600w,/reponame/static/c019bd434e5489eb40e386b60cf045c9/13b13/logo-black.webp 1200w,/reponame/static/c019bd434e5489eb40e386b60cf045c9/b4361/logo-black.webp 2400w" sizes="(min-width: 2400px) 2400px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 2400px) 2400px, 100vw" decoding="async" loading="lazy" src="/reponame/static/c019bd434e5489eb40e386b60cf045c9/78e61/logo-black.png" srcSet="/reponame/static/c019bd434e5489eb40e386b60cf045c9/7237d/logo-black.png 600w,/reponame/static/c019bd434e5489eb40e386b60cf045c9/02c57/logo-black.png 1200w,/reponame/static/c019bd434e5489eb40e386b60cf045c9/78e61/logo-black.png 2400w" alt="cloudqubes logo"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div></a></div></div></div></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script async="" src="YOUR_SELF_HOSTED_ORIGIN/gtag/js?id=GA-TRACKING_ID"></script><script>
      window.excludeGtagPaths=[/^(?:\/preview\/(?:(?!(?:\/|^)\.).)*?)$/,/^(?:\/do\-not\-track\/me\/too\/)$/];
      function gaOptout(){document.cookie=disableStr+'=true; expires=Thu, 31 Dec 2099 23:59:59 UTC;path=/',window[disableStr]=!0}var gaProperty='GA-TRACKING_ID',disableStr='ga-disable-'+gaProperty;document.cookie.indexOf(disableStr+'=true')>-1&&(window[disableStr]=!0);
      if(!(navigator.doNotTrack == "1" || window.doNotTrack == "1")) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'GA-TRACKING_ID', {"optimize_id":"OPT_CONTAINER_ID","anonymize_ip":true,"cookie_expires":0,"send_page_view":false});gtag('config', 'AW-CONVERSION_ID', {"optimize_id":"OPT_CONTAINER_ID","anonymize_ip":true,"cookie_expires":0,"send_page_view":false});gtag('config', 'DC-FLOODIGHT_ID', {"optimize_id":"OPT_CONTAINER_ID","anonymize_ip":true,"cookie_expires":0,"send_page_view":false});
      }
      </script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/how-to-use-ingress/";/*]]>*/</script><!-- slice-start id="_gatsby-scripts-1" -->
          <script
            id="gatsby-chunk-mapping"
          >
            window.___chunkMapping="{\"app\":[\"/app-99df59895fe43cd139fd.js\"],\"component---src-pages-404-js\":[\"/component---src-pages-404-js-e0852996b6bca8f74aa4.js\"],\"component---src-pages-about-js\":[\"/component---src-pages-about-js-9c7435f04178a6da9c8d.js\"],\"component---src-pages-blog-index-js\":[\"/component---src-pages-blog-index-js-b8b3dc705cca64c2932e.js\"],\"component---src-pages-blog-mdx-frontmatter-slug-js-content-file-path-blog-ansible-for-verifying-configurations-index-mdx\":[\"/component---src-pages-blog-mdx-frontmatter-slug-js-content-file-path-blog-ansible-for-verifying-configurations-index-mdx-afe6398166433d3038cb.js\"],\"component---src-pages-blog-mdx-frontmatter-slug-js-content-file-path-blog-docker-cli-quick-reference-index-mdx\":[\"/component---src-pages-blog-mdx-frontmatter-slug-js-content-file-path-blog-docker-cli-quick-reference-index-mdx-c994075bab761847891f.js\"],\"component---src-pages-blog-mdx-frontmatter-slug-js-content-file-path-blog-how-to-choose-the-best-database-index-mdx\":[\"/component---src-pages-blog-mdx-frontmatter-slug-js-content-file-path-blog-how-to-choose-the-best-database-index-mdx-cf60e62701df65bb1bf7.js\"],\"component---src-pages-blog-mdx-frontmatter-slug-js-content-file-path-blog-how-to-extend-root-disk-ubuntu-index-mdx\":[\"/component---src-pages-blog-mdx-frontmatter-slug-js-content-file-path-blog-how-to-extend-root-disk-ubuntu-index-mdx-f6c4ac73f54cbde106d5.js\"],\"component---src-pages-blog-mdx-frontmatter-slug-js-content-file-path-blog-how-to-set-up-private-git-server-index-mdx\":[\"/component---src-pages-blog-mdx-frontmatter-slug-js-content-file-path-blog-how-to-set-up-private-git-server-index-mdx-188e8075cc83e739a35d.js\"],\"component---src-pages-blog-mdx-frontmatter-slug-js-content-file-path-blog-how-to-use-ingress-index-mdx\":[\"/component---src-pages-blog-mdx-frontmatter-slug-js-content-file-path-blog-how-to-use-ingress-index-mdx-084bec8f68795acd706b.js\"],\"component---src-pages-blog-mdx-frontmatter-slug-js-content-file-path-blog-ingress-vs-ingress-controller-index-mdx\":[\"/component---src-pages-blog-mdx-frontmatter-slug-js-content-file-path-blog-ingress-vs-ingress-controller-index-mdx-6736286014ae3db7976a.js\"],\"component---src-pages-blog-mdx-frontmatter-slug-js-content-file-path-blog-introduction-to-kubernetes-index-mdx\":[\"/component---src-pages-blog-mdx-frontmatter-slug-js-content-file-path-blog-introduction-to-kubernetes-index-mdx-efb76b76e6a376ab8ca1.js\"],\"component---src-pages-blog-mdx-frontmatter-slug-js-content-file-path-blog-introduction-to-networking-in-aws-index-mdx\":[\"/component---src-pages-blog-mdx-frontmatter-slug-js-content-file-path-blog-introduction-to-networking-in-aws-index-mdx-9895191b0eac61ffa9cf.js\"],\"component---src-pages-blog-mdx-frontmatter-slug-js-content-file-path-blog-managing-multiple-github-accounts-index-mdx\":[\"/component---src-pages-blog-mdx-frontmatter-slug-js-content-file-path-blog-managing-multiple-github-accounts-index-mdx-b909daa96e6293791344.js\"],\"component---src-pages-blog-mdx-frontmatter-slug-js-content-file-path-blog-private-container-registry-with-harbor-index-mdx\":[\"/component---src-pages-blog-mdx-frontmatter-slug-js-content-file-path-blog-private-container-registry-with-harbor-index-mdx-49f67c5889dd97fa1b2b.js\"],\"component---src-pages-blog-mdx-frontmatter-slug-js-content-file-path-blog-running-applications-on-kubernetes-index-mdx\":[\"/component---src-pages-blog-mdx-frontmatter-slug-js-content-file-path-blog-running-applications-on-kubernetes-index-mdx-ebb2699c9ab094dd4296.js\"],\"component---src-pages-blog-mdx-frontmatter-slug-js-content-file-path-blog-what-is-a-kubernetes-service-index-mdx\":[\"/component---src-pages-blog-mdx-frontmatter-slug-js-content-file-path-blog-what-is-a-kubernetes-service-index-mdx-d141ab8106acd861861d.js\"],\"component---src-pages-blog-mdx-frontmatter-slug-js-content-file-path-pages-contat-mdx\":[\"/component---src-pages-blog-mdx-frontmatter-slug-js-content-file-path-pages-contat-mdx-9326d65683be0f96cc1c.js\"],\"component---src-pages-contact-js\":[\"/component---src-pages-contact-js-02427b5b2070026b4355.js\"],\"component---src-pages-index-js\":[\"/component---src-pages-index-js-c30b3eac07dce0bf40ec.js\"],\"component---src-templates-tag-js\":[\"/component---src-templates-tag-js-5cc1516838474c58ac19.js\"]}";
          </script>
        <script>window.___webpackCompilationHash="02a25c0e28664a0ffa30";</script><script src="/reponame/webpack-runtime-7629d094d2c25b368a50.js" async></script><script src="/reponame/framework-9e8f4a38befa1ae8eeac.js" async></script><script src="/reponame/app-99df59895fe43cd139fd.js" async></script><!-- slice-end id="_gatsby-scripts-1" --></body></html>