"use strict";(self.webpackChunkcloudqubes=self.webpackChunkcloudqubes||[]).push([[152],{6980:function(e,n,t){t.r(n),t.d(n,{Head:function(){return m},default:function(){return d}});var a=t(1151),l=t(7294);function i(e){const n=Object.assign({p:"p",img:"img",em:"em",h1:"h1",code:"code",pre:"pre",ol:"ol",li:"li",blockquote:"blockquote"},(0,a.ah)(),e.components);return l.createElement(l.Fragment,null,l.createElement("div",{class:"header-highlight"},l.createElement(n.p,null,"A containerized application running in Kubernetes is a collection of Pods. Kubernetes takes care of scheduling these Pods across nodes in a cluster.")),"\n",l.createElement(n.p,null,"A containerized application is composed of microservices where each microservice is deployed in a container. A Pod is a group of one or more containers running in the same node."),"\n",l.createElement(n.p,null,"This is a containerized application with three containers in two Pods."),"\n",l.createElement(n.p,null,l.createElement(n.img,{src:"./running-containerized-apps/containerized-app-1.png",alt:"A containerized application in Kubernetes"}),"\n",l.createElement(n.em,null,"A containerized application")),"\n",l.createElement(n.p,null,"To run this application in a Kubernetes cluster, we must instruct Kubernetes on how to create the Pods.\nThere are several methods of doing that."),"\n",l.createElement(n.h1,null,"Create individual Pods"),"\n",l.createElement(n.p,null,"You can use the ",l.createElement(n.code,null,"kubectl")," command to create individual pods."),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-shell"},"cloud@ubuntu:~$ microk8s kubectl run nginx --image=nginx\npod/nginx created\ncloud@ubuntu:~$ microk8s kubectl get pods\nNAME   READY   STATUS              RESTARTS   AGE\nNginx   0/1     ContainerCreating   0          11s\n")),"\n",l.createElement(n.p,null,"When a Pod is no longer needed, it can be deleted using the ",l.createElement(n.code,null,"kubectl delete")," command."),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-shell"},'cloud@ubuntu:~$ microk8s kubectl delete pods/nginx\npod "nginx" deleted\n')),"\n",l.createElement(n.p,null,"A Pod is an object in Kubernetes. The above commands are directly creating and deleting the Pod objects."),"\n",l.createElement(n.p,null,"This method is known as managing Kubernetes objects with imperative commands."),"\n",l.createElement(n.p,null,"It works for creating one or two pods for testing purpose or a one-off task. But, it’s not practical, if not impossible for an application that has hundreds of Pods."),"\n",l.createElement(n.p,null,"Instead of creating Pods individually, we can use Kubernetes configuration files for such applications."),"\n",l.createElement(n.h1,null,"Kubernetes configuration files"),"\n",l.createElement(n.p,null,"Kubernetes configuration files are YAML-formatted definitions of Kubernetes objects. A single configuration file can hold definitions of multiple objects. Since a Pod is also an object in Kubernetes, you can use these configuration files for deploying an application with multiple Pods."),"\n",l.createElement(n.h1,null,"Using configuration files imperatively"),"\n",l.createElement(n.p,null,"Here’s a configuration file with two Pod definitions. The ",l.createElement(n.code,null,"spec")," field specifies the configuration of containers in each Pod. Each Pod in this configuration file runs one Nginx container."),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-yaml"},"\napiVersion: v1\nkind: Pod\nmetadata:\n  name: nginx-pod-1\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.23.2\n    ports:\n    - containerPort: 80\n        \n---\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: nginx-pod-2\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.23.2\n    ports:\n    - containerPort: 80  \n")),"\n",l.createElement(n.p,null,"The ",l.createElement(n.code,null,"kubectl create")," command accepts the file as an input and creates the two pods."),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-shell"},"cloud@ubuntu:~/projects/kube-config$ microk8s kubectl create -f nginxpod.yml \npod/nginx-pod-1 created\npod/nginx-pod-2 created\n")),"\n",l.createElement(n.p,null,"Let’s try to amend our application with one more pod by updating the configuration file."),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-yaml"},"apiVersion: v1\nkind: Pod\nmetadata:\n  name: nginx-pod-1\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.23.2\n    ports:\n    - containerPort: 80\n        \n---\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: nginx-pod-2\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.23.2\n    ports:\n    - containerPort: 80     \n\n---\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: nginx-pod-3\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.23.2\n    ports:\n    - containerPort: 80    \n")),"\n",l.createElement(n.p,null,"Using the ",l.createElement(n.code,null,"kubectl create")," command with the updated configuration file."),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-shell"},'cloud@ubuntu:~/projects/kube-config$ microk8s kubectl create -f nginxpod.yml \npod/nginx-pod-3 created\nError from server (AlreadyExists): error when creating "nginxpod.yml": pods "nginx-pod-1" already exists\nError from server (AlreadyExists): error when creating "nginxpod.yml": pods "nginx-pod-2" already exists\ncloud@ubuntu:~/projects/kube-config$ microk8s kubectl get pods\nNAME          READY   STATUS    RESTARTS   AGE\nnginx-pod-1   1/1     Running   0          4m25s\nnginx-pod-2   1/1     Running   0          4m25s\nnginx-pod-3   1/1     Running   0          27s\n')),"\n",l.createElement(n.p,null,"It prints an error indicating that ",l.createElement(n.code,null,"nginx-pod-1")," and ",l.createElement(n.code,null,"nginx-pod-2")," already exist. But, ",l.createElement(n.code,null,"nginx-pod-3")," is created."),"\n",l.createElement(n.p,null,"In this method, we are creating Kubernetes objects imperatively using Kubernetes configuration files. But, there is a better method."),"\n",l.createElement(n.h1,null,"Using configuration files declaratively"),"\n",l.createElement(n.p,null,"A declarative definition contains the end state we wish to achieve. Therefore, when using the declarative method we use the `kubectl apply’ command. It will scan the configuration file, and amend the cluster to match our definitions."),"\n",l.createElement(n.p,null,"Remember to delete all Pods created in earlier steps before executing this command."),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-shell"},"cloud@ubuntu:~/projects/kube-config$ microk8s kubectl apply -f nginxpod.yml \npod/nginx-pod-1 created\npod/nginx-pod-2 created\npod/nginx-pod-3 created\n")),"\n",l.createElement(n.p,null,"Let’s try to amend our workload with one more pod."),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-yaml"},"apiVersion: v1\nkind: Pod\nmetadata:\n  name: nginx-pod-1\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.23.2\n    ports:\n    - containerPort: 80\n        \n---\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: nginx-pod-2\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.23.2\n    ports:\n    - containerPort: 80     \n\n---\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: nginx-pod-3\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.23.2\n    ports:\n    - containerPort: 80\n\n---\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: nginx-pod-4\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.23.2\n    ports:\n    - containerPort: 80    \n")),"\n",l.createElement(n.p,null,"Running the ",l.createElement(n.code,null,"kubectl apply")," again."),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-shell"},"cloud@ubuntu:~/projects/kube-config$ microk8s kubectl apply -f nginxpod.yml \npod/nginx-pod-1 unchanged\npod/nginx-pod-2 unchanged\npod/nginx-pod-3 unchanged\npod/nginx-pod-4 created\n")),"\n",l.createElement(n.p,null,"We are not getting an error this time. Kubernetes can identify that pod-1 to 3 already exists so it’s creating the fourth pod only."),"\n",l.createElement(n.p,null,"However, running a workload as a collection of individual pods is not a good practice. If our application has hundreds of pods, we would have to copy-paste the pod definition a hundred times. Kubernetes has a higher-level object for such use cases."),"\n",l.createElement(n.h1,null,"ReplicaSet"),"\n",l.createElement(n.p,null,"A ReplicaSet is a group of pods. This is a definition of a ReplicaSet with three Pods, indicated by ",l.createElement(n.code,null,"replicas")," field."),"\n",l.createElement(n.p,null,"A ReplicaSet can have only one Pod ",l.createElement(n.code,null,"spec"),".  The Pod spec in this ReplicaSet has one Nginx container and the RelicaSet will create three replicas of this Pod."),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-shell"},"apiVersion: apps/v1\nkind: ReplicaSet\nmetadata:\n  name: nginx\n  labels:\n    app: webapp\nspec:\n  # modify replicas according to your case\n  replicas: 3\n  selector:\n    matchLabels:\n      webapp: nginx\n  template:\n    metadata:\n      labels:\n        webapp: nginx\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.23.2\n        ports:\n        - containerPort: 80\n")),"\n",l.createElement(n.p,null,"Using ",l.createElement(n.code,null,"kubectl apply")," to create the ReplicaSet"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-shell"},"cloud@ubuntu:~/projects/kube-config$ microk8s kubectl apply -f nginx-replica.yml \nreplicaset.apps/nginx created\ncloud@ubuntu:~/projects/kube-config$ microk8s kubectl get rs\nNAME    DESIRED   CURRENT   READY   AGE\nnginx   3         3         0       5s\ncloud@ubuntu:~/projects/kube-config$ microk8s kubectl get rs\nNAME    DESIRED   CURRENT   READY   AGE\nnginx   3         3         3       10s\ncloud@ubuntu:~/projects/kube-config$ microk8s kubectl get pods\nNAME          READY   STATUS    RESTARTS   AGE\nnginx-xmlpq   1/1     Running   0          13s\nnginx-ncbnq   1/1     Running   0          12s\nnginx-mpvtn   1/1     Running   0          12s\n")),"\n",l.createElement(n.p,null,"We can easily scale this workload to any number of pods by altering the value of ",l.createElement(n.code,null,"spec.replicas")," field."),"\n",l.createElement(n.p,null,"Let’s update it to 4."),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-yaml"},"  replicas: 4\n")),"\n",l.createElement(n.p,null,"Using the ",l.createElement(n.code,null,"kubectl apply")," to update our workload."),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-shell"},"cloud@ubuntu:~/projects/kube-config$ microk8s kubectl apply -f nginx-replica.yml \nreplicaset.apps/nginx configured\ncloud@ubuntu:~/projects/kube-config$ microk8s kubectl get pods\nNAME          READY   STATUS    RESTARTS   AGE\nnginx-xmlpq   1/1     Running   0          2m24s\nnginx-ncbnq   1/1     Running   0          2m23s\nnginx-mpvtn   1/1     Running   0          2m23s\nnginx-4h69h   1/1     Running   0          6s\n")),"\n",l.createElement(n.p,null,"Scaling down is also easy. Just update the number of replicas to your desired count and run ",l.createElement(n.code,null,"kubectl apply"),". Here we are bringing down the number of Pods to two."),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-shell"},"cloud@ubuntu:~/projects/kube-config$ microk8s kubectl apply -f nginx-replica.yml \nreplicaset.apps/nginx configured\ncloud@ubuntu:~/projects/kube-config$ microk8s kubectl get pods\nNAME          READY   STATUS        RESTARTS   AGE\nnginx-mpvtn   1/1     Running       0          4m40s\nnginx-4h69h   1/1     Running       0          2m23s\nnginx-ncbnq   1/1     Terminating   0          4m40s\ncloud@ubuntu:~/projects/kube-config$ microk8s kubectl get pods\nNAME          READY   STATUS    RESTARTS   AGE\nnginx-mpvtn   1/1     Running   0          4m43s\nnginx-4h69h   1/1     Running   0          2m26s\n")),"\n",l.createElement(n.p,null,"ReplicaSets simplify the scaling of a containerized application. You can adjust the number of replicas to match the current load."),"\n",l.createElement(n.p,null,"However, running standalone ReplicaSets is also not a recommended approach in Kubernetes. Instead, you must use Kubernetes Workloads."),"\n",l.createElement(n.h1,null,"Kubernetes Workloads"),"\n",l.createElement(n.p,null,"A Kubernetes Workload is a collection of Pods that is managed by a Workload controller. This controller reschedules failed Pods to ensure that the required number of healthy Pods are always available."),"\n",l.createElement(n.p,null,"Kubernetes has five built-in workload types, and you can create additional types by writing a custom controller."),"\n",l.createElement(n.ol,null,"\n",l.createElement(n.li,null,"Deployment"),"\n"),"\n",l.createElement(n.blockquote,null,"\n",l.createElement(n.p,null,"A Deployment consists of Pods that do not need to maintain any persistent states. A typical example is a front-end of a web application. It will consist of a web server such as Nginx and the application logic that is responsible for interacting with databases and serving the HTML views."),"\n"),"\n",l.createElement(n.ol,{start:"2"},"\n",l.createElement(n.li,null,"StatefulSet"),"\n"),"\n",l.createElement(n.blockquote,null,"\n",l.createElement(n.p,null,"Pods in a StatefulSet can maintain persistent states. These Pods can have Kubernetes Persistent Volumes."),"\n"),"\n",l.createElement(n.ol,{start:"3"},"\n",l.createElement(n.li,null,"DaemonSet"),"\n"),"\n",l.createElement(n.blockquote,null,"\n",l.createElement(n.p,null,"A DaemonSet will run a copy of a Pod on all nodes. A DaemonSet is useful for cluster-wide services such as monitoring node health, log collection, etc."),"\n"),"\n",l.createElement(n.ol,{start:"4"},"\n",l.createElement(n.li,null,"Job"),"\n"),"\n",l.createElement(n.blockquote,null,"\n",l.createElement(n.p,null,"A Job is a one-time task. Once a Job is created, Kubernetes will ensure that the specified number of Pods are executed till completion."),"\n"),"\n",l.createElement(n.ol,{start:"5"},"\n",l.createElement(n.li,null,"CronJob"),"\n"),"\n",l.createElement(n.blockquote,null,"\n",l.createElement(n.p,null,"CronJob is a Job that Kubernetes repeats at scheduled intervals."),"\n"),"\n",l.createElement("div",{class:"inline-highlight"},l.createElement(n.p,null,"All production applications must be managed as Workloads in Kubernetes.")),"\n",l.createElement(n.p,null,"A typical containerized application will be a combination of different types of Workloads."),"\n",l.createElement(n.p,null,"A web application usually has a set of stateless frontend services and a stateful backend datastore. Therefore, this application must be deployed into Kubernetes using Deployment and StatefulSets Workloads."),"\n",l.createElement(n.p,null,l.createElement(n.img,{src:"./running-containerized-apps/containerized-app-2.png",alt:"A containerized web application"}),"\n",l.createElement(n.em,null,"A web application with frontend and backend pods.")),"\n",l.createElement(n.p,null,"If we are to enhance this web application with a newsletter service, we can add a new Pod of type CronJob."),"\n",l.createElement(n.p,null,l.createElement(n.img,{src:"./running-containerized-apps/containerized-app-3.png",alt:"A containerized web application with a CronJob"}),"\n",l.createElement(n.em,null,"A web application including a CronJob.")),"\n",l.createElement(n.h1,null,"Creating a Deployment"),"\n",l.createElement(n.p,null,"This is a definition of a Deployment that runs two replicas of an Nginx Pod."),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-yaml"},"apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: nginx-deployment\nspec:\n  selector:\n    matchLabels:\n      app: nginx\n  replicas: 2 \n  template:\n    metadata:\n      labels:\n        app: nginx\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.23.2\n        ports:\n        - containerPort: 80\n")),"\n",l.createElement(n.p,null,"Using ",l.createElement(n.code,null,"kubectl apply")," to create the deployment"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-shell"},"cloud@ubuntu:~/projects/kube-config$ microk8s kubectl apply -f nginx.yml \ndeployment.apps/nginx-deployment created\ncloud@ubuntu:~/projects/kube-config$ microk8s kubectl get pods\nNAME                                READY   STATUS              RESTARTS   AGE\nnginx-deployment-86956f97b8-h4t6p   0/1     ContainerCreating   0          7s\nnginx-deployment-86956f97b8-wms8g   0/1     ContainerCreating   0          7s\ncloud@ubuntu:~/projects/kube-config$ microk8s kubectl get pods\nNAME                                READY   STATUS    RESTARTS   AGE\nnginx-deployment-86956f97b8-h4t6p   1/1     Running   0          36s\nnginx-deployment-86956f97b8-wms8g   1/1     Running   0          36s\n")),"\n",l.createElement(n.p,null,"Query the Deployment and the ReplicaSet within the Deployment with ",l.createElement(n.code,null,"kubectl"),"."),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-shell"},"cloud@ubuntu:~/projects/kube-config$ microk8s kubectl get deployment\nNAME               READY   UP-TO-DATE   AVAILABLE   AGE\nnginx-deployment   2/2     2            2           3m37s\ncloud@ubuntu:~/projects/kube-config$ microk8s kubectl get rs\nNAME                          DESIRED   CURRENT   READY   AGE\nnginx-deployment-86956f97b8   2         2         2       3m41s\ncloud@ubuntu:~/projects/kube-config$ \n")),"\n",l.createElement(n.p,null,"All types of Kubernetes Workloads can be created using configuration files like this.\nWe will dig into more details about each type of Workload in a series of upcoming articles."))}var o=function(e){void 0===e&&(e={});const{wrapper:n}=Object.assign({},(0,a.ah)(),e.components);return n?l.createElement(n,e,l.createElement(i,e)):i(e)},r=t(72),c=t(5595),s=t(8370);const u=e=>{let{data:n,children:t}=e;return l.createElement(r.Z,{pageTitle:n.mdx.frontmatter.title},l.createElement("div",{className:s.HV},l.createElement("article",{className:s.nC},l.createElement("div",null,l.createElement("span",{className:s.F4},n.mdx.frontmatter.date," - "),l.createElement("span",{className:s.F4},n.mdx.fields.timeToRead.text)),l.createElement("h1",{className:s.TN},n.mdx.frontmatter.title),t)))},m=e=>{let{data:n}=e;return l.createElement(c.p,{title:n.mdx.frontmatter.title,description:n.mdx.frontmatter.description})};function d(e){return l.createElement(u,e,l.createElement(o,e))}},5595:function(e,n,t){t.d(n,{p:function(){return i}});var a=t(7294),l=t(1883);const i=e=>{let{title:n,description:t,pathname:i,children:o}=e;const{title:r,description:c,image:s,siteUrl:u,twitterUsername:m}=(0,l.useStaticQuery)("1865044719").site.siteMetadata,d={title:n||r,description:t||c,image:""+u+s,url:""+u+(i||""),twitterUsername:m};return a.createElement(a.Fragment,null,a.createElement("title",null,d.title),a.createElement("meta",{name:"description",content:d.description}),a.createElement("meta",{name:"image",content:d.image}),a.createElement("meta",{name:"twitter:card",content:"summary_large_image"}),a.createElement("meta",{name:"twitter:title",content:d.title}),a.createElement("meta",{name:"twitter:url",content:d.url}),a.createElement("meta",{name:"twitter:description",content:d.description}),a.createElement("meta",{name:"twitter:image",content:d.image}),a.createElement("meta",{name:"twitter:creator",content:d.twitterUsername}),a.createElement("link",{rel:"icon",href:"data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>👤</text></svg>"}),o)}},8370:function(e,n,t){t.d(n,{F4:function(){return i},HV:function(){return l},TN:function(){return o},nC:function(){return a}});var a="article-module--container--2d8cc",l="article-module--outerContainer--119e3",i="article-module--post-meta--34964",o="article-module--title--f5d32"},1151:function(e,n,t){t.d(n,{ah:function(){return i}});var a=t(7294);const l=a.createContext({});function i(e){const n=a.useContext(l);return a.useMemo((()=>"function"==typeof e?e(n):{...n,...e}),[n,e])}}}]);
//# sourceMappingURL=component---src-pages-blog-mdx-frontmatter-slug-js-content-file-path-blog-running-applications-on-kubernetes-index-mdx-ebb2699c9ab094dd4296.js.map